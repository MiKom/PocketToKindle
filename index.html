<html>

<head>
    <title>Pocket to kindle</title>
    <style>
        .wrapper {
            font-family: Tahoma;
            max-width: 50em;
            margin: 0 auto;
        }

        .footer {
            text-align: center;
        }

        .footer a {
            color: grey;
        }

        button {
            padding: 0.5em 2em;
        }

        li {
            margin-bottom: 1em;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <h1>
            Pocket to kindle
        </h1>
        <div>
            Pocket to kindle sends your pocket articles to your kindle!
        </div>

        <h2>Register</h2>
        <ol>
            <li>
                First,
                <p>
                    <button id="authorize-pocket-button">Authorize Pocket</button>
                </p>
            </li>
            <li>
                Next go to
                <a href="https://www.amazon.com/hz/mycd/myx#/home/settings/payment">Kindle email allowed senders</a> under "Personal Document Settings" and add "kindle@mail.sejkapp.pl" as approved
                email.
            </li>
            <li>
                Finally, find your kindle email in "Your Devices" tab and share it below:
                <br/>
                <p>
                    <input id="email-input" type="text">
                    <br />
                    <button id="submit-button">Submit</button>
                </p>
            </li>
            <li>
                That's it! If everything went fine you should receive an welcoming email on your kindle. Next time you add something to your pocket it should arrive within 15 minutes on your kindle. Enjoy!
            </li>
        </ol>
        <div class="footer">
            <a href="https://github.com/sejka/pockettokindle">Source code</a>
            <a href="https://twitter.com/karolsejka">Karol Sejka</a>
        </div>
    </div>
    <script type="text/javascript">
        var authorizeButton = document.getElementById('authorize-pocket-button');
        var submitButton = document.getElementById('submit-button');
        submitButton.onclick = register;
        authorizeButton.onclick = authroizeOnPocket;

        function register() {
            var xhReq = new XMLHttpRequest();
            xhr.setRequestHeader("Content-Type", "application/json");
            xhReq.open("POST",
                "https://pocket-to-kindle.azurewebsites.net/api/Register",
                false);

            var kindleEmail = document.getElementById('email-input').value;
            var url = new URL(window.location.href);
            var requestCode = document.cookie;

            var data = JSON.stringify({
                "kindleEmail": kindleEmail,
                "requestCode": requestCode
            });
            xhr.send(data);
            var serverResponse = xhReq.responseText;
            alert(serverResponse);
        }

        function authroizeOnPocket() {
            var xhReq = new XMLHttpRequest();
            xhReq.open("GET",
                "https://pocket-to-kindle.azurewebsites.net/api/GetRegistrationInfo",
                false);
            xhReq.send(null);
            var serverResponse = JSON.parse(xhReq.responseText);
            document.cookie = serverResponse.RequestCode;
            window.location.href = serverResponse.RegistrationLink;
        }
    </script>
</body>

</html>